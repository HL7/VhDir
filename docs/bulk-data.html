<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>HL7-FHIR-UV-VHDIR\Bulk Data and Subscriptions - FHIR v4.0.1</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->

    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"2.3"}
    h3,h4,h5,h6{--heading-prefix:"2.3"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->
      <div class="container">  <!-- container -->
        <!-- Placeholder for child template header declarations -->


        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">Validated Healthcare Directory</span>
            <br/>
            <span style="display:inline-block;">0.2.0 - CI Build


            </span>
          </p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->

    <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">  <!-- container -->
        <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
          <!--status-bar-->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a class="navbar-brand hidden" href="http://hl7.org/fhir/R4/index.html">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <!-- menu.xml  -->

<ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
  <li>
    <a href="index.html">Home</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Guidance
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="general-guidance.html">General Guidance</a>
      </li>
      <li>
        <a href="technical-guidance.html">Technical Guidance</a>
      </li>
      <li>
        <a href="bulk-data.html">Bulk Data and Subscriptions</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">FHIR Artifacts
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="artifacts.html#1">CapabilityStatements</a>
      </li>
      <li>
        <a href="artifacts.html#2">Operations</a>
      </li>
      <li>
        <a href="artifacts.html#3">SearchParameters</a>
      </li>
      <li>
        <a href="artifacts.html#4">Profiles</a>
      </li>
      <li>
        <a href="artifacts.html#5">Extensions</a>
      </li>
      <li>
        <a href="artifacts.html#6">Value Sets</a>
      </li>
      <li>
        <a href="artifacts.html#7">Code Systems</a>
      </li>
      <li>
        <a href="artifacts.html#8">Examples</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="downloads.html">Downloads</a>
  </li>
  <li>
    <a href="change-notes.html">Change Notes</a>
  </li>
</ul>
            </div>  <!-- /.nav-collapse -->
          </div>  <!-- /.container -->
        </nav>  <!-- /.navbar -->
      <!-- /HEADER CONTENT -->
      </div>  <!-- /container -->
    </div>  <!-- /segment-navbar -->
    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><a href='guidance.html'><b>Guidance</b></a></li><li><b>Bulk Data and Subscriptions</b></li>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">Validated Healthcare Directory - Local Development build (v0.2.0). See the <a href="http://hl7.org/fhir/uv/vhdir/history.html">Directory of published versions</a></p><!--EndReleaseHeader-->
  <h2>Bulk Data and Subscriptions</h2>
  











    <p><!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#background" id="markdown-toc-background">Background</a></li>
  <li><a href="#healthcare-directory-bulk-data-specifics" id="markdown-toc-healthcare-directory-bulk-data-specifics">Healthcare Directory Bulk Data Specifics</a>    <ul>
      <li><a href="#the-scope-of-the-data-selection" id="markdown-toc-the-scope-of-the-data-selection">The scope of the data selection</a></li>
      <li><a href="#list-defined-subsets" id="markdown-toc-list-defined-subsets">List defined subsets</a></li>
      <li><a href="#arbitrary-subsets-of-data" id="markdown-toc-arbitrary-subsets-of-data">Arbitrary subsets of data</a></li>
      <li><a href="#format-of-the-bulk-data-extract" id="markdown-toc-format-of-the-bulk-data-extract">Format of the bulk data extract</a></li>
      <li><a href="#starting-the-extract" id="markdown-toc-starting-the-extract">Starting the extract</a></li>
      <li><a href="#tracking-the-status-of-the-extract" id="markdown-toc-tracking-the-status-of-the-extract">Tracking the status of the extract</a></li>
      <li><a href="#retrieving-the-complete-extract" id="markdown-toc-retrieving-the-complete-extract">Retrieving the complete extract</a></li>
      <li><a href="#finishing-the-extract" id="markdown-toc-finishing-the-extract">Finishing the extract</a></li>
    </ul>
  </li>
  <li><a href="#subscriptions" id="markdown-toc-subscriptions">Subscriptions</a></li>
</ul>

</div>
<!-- ---
title: Bulk Data and Subscriptions
layout: default
active: bulk-data
topofpage: true
sectionnumbering: true
F: http://build.fhir.org/

--- -->

<p class="note-to-balloters">
<b>Informative only:</b> was not a part of the September 2018 ballotted content.<br />
It will be updated based on the Bulk Data ballot outcome, and further implementation experience.
</p>
<p><br /></p>

<h2 id="background">Background</h2>

<p>Bulk data is a recent addition to the FHIR related specifications and has many uses. Primarily its for out of band data extraction for distribution.</p>

<p>There are several basic parts to FHIR’s bulk data extract</p>

<ul>
  <li>The scope of data selection</li>
  <li>The format of the bulk data extract (nd-json) *</li>
  <li>The async operation request and status tracking (as these processes may take significant processing time) *</li>
  <li>Retrieval of the completed export</li>
  <li>Closing/cleanup of the completed export *</li>
</ul>

<p><em>(The items marked with * can be considered quite mature, and unlikely to change from this point)</em></p>

<p>The bulk data had been balloted and was still being reconciled and at the time of publication of this guide, the current development version can be found here:</p>

<p>        <a href="http://hl7.org/fhir/us/bulkdata/2019May/index.html">http://hl7.org/fhir/us/bulkdata/2019May/index.html</a></p>

<p>The community discussions and questions around this draft specification are here:</p>

<p>        <a href="https://chat.fhir.org/#narrow/stream/179250-bulk-data">https://chat.fhir.org/#narrow/stream/179250-bulk-data</a></p>

<h2 id="healthcare-directory-bulk-data-specifics">Healthcare Directory Bulk Data Specifics</h2>
<h3 id="the-scope-of-the-data-selection">The scope of the data selection</h3>

<p>For the directory bulk data extraction, to request an entire copy of all content in the directory, the scope selection can be defined at the top level, and just specifying that we would like to retrieve all content for the specified resource types from the base of the FHIR server.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET [base]/$export?_type=Organization,Location,Practitioner,PractitionerRole,HealthcareService,VerificationResult, ...
</code></pre></div></div>

<p>A healthcare directory may curate such an extract on a nightly process, and just return this without needing to scan the live system, and the value returned in the <code>transactionTime</code> in the result should contain the timestamp at which this was generated (including timezone information), and that should be used in a subsequent call to retrieve changes since this point in time.</p>

<p>Once a system has a complete set of data, it is usually more efficient to ask for changes since a point in time, in which case the request should use the value above (<code>transactionTime</code>) to update the local directory.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET [base]/$export?_type=Organization,Location,Practitioner, ... &amp;_since=[transactionTime]
</code></pre></div></div>

<p>This behaves just the same as the initial request, with the exception of the content.</p>

<p>We would expect that this is more likely to return the current information, rather than from a pre-generated snapshot, as the transactionTime could be anything.</p>

<blockquote>
  <p><strong>Note:</strong> The current bulk data handling specification does not handle deleted items, and the recommendation is that periodically a complete download should be done to check for “gaps” to reconcile the deletions (which could also be due to security changes), however content shouldn’t usually be “deleted” it should be marked as inactive, or end dated.</p>

  <p><strong>Proposal:</strong> Include deletions bundle(s) for each resource type to report the deletions (when using the _since parameter) which would be in a new property “deletions” in the process output, as demonstrated in the status tracking output section below. This bundle would have a type of “collection”, and each entry would be as per a deleted item in a history.</p>
</blockquote>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;entry&gt;</span>
   <span class="c">&lt;!-- no resource included for a delete --&gt;</span>
   <span class="nt">&lt;request&gt;</span>
     <span class="nt">&lt;method</span> <span class="na">value=</span><span class="s">"DELETE"</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;url</span> <span class="na">value=</span><span class="s">"PractitionerRole/[id]"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/request&gt;</span>
   <span class="c">&lt;!-- response carries the instant the server processed the delete --&gt;</span>
   <span class="nt">&lt;response&gt;</span>
     <span class="nt">&lt;lastModified</span> <span class="na">value=</span><span class="s">"2014-08-20T11:05:34.174Z"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/response&gt;</span>
<span class="nt">&lt;/entry&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>The total in the bundle will just be the count of deletions in the file, the total in the operation result will indicate the number of deletion bundles in the ndjson (same as the other types).</p>

  <p>If the caller doesn’t want to use the deletions, they can just ignore the files in the output, and not download those specific files.</p>
</blockquote>

<h3 id="list-defined-subsets">List defined subsets</h3>

<p>The previous sections are all that is defined by the FHIR Bulk Data extract specification, however we may choose to implement an additional parameter to this operation to permit the selection to also filter to resources that are included in a specified list resource. The approach is similar to the same capability defined by FHIR <a href="http://hl7.org/fhir/search.html#list">http://hl7.org/fhir/search.html#list</a></p>

<p>This could be used by client applications such as a Primary Care System that wanted to only periodically update using this technique, but only with resources that they currently have loaded in their “local directory” - internal black book, which were cached there from previous searches to the system.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET [base]/$export?_type=Organization,Location,Practitioner,PractitionerRole,HealthcareService&amp;_list=List/45
</code></pre></div></div>

<p>In this example the Primary Care System would be responsible for keeping <code>List/45</code> up to date with what it is tracking, and a national service may decide that permitting this List resource management is too much overhead, however local enterprise directories may support this type of functionality.</p>

<h3 id="arbitrary-subsets-of-data">Arbitrary subsets of data</h3>

<p>The current bulk data export operations use the Group resource to define the set of data related to a Patient, and at present there is no definition for this to be done in the directory space, apart from at the resource type level. This is possible with search and subscriptions (which leverage search) by using search parameters on the resource types and setting the parameters of interest.</p>

<p>When defining a subset of data, consideration should be given to what happens when data is changed such that it no longer is within the context of the conditions.</p>

<p>One possibility would be to use a bundle of searches where each type has it’s own search parameters, another is to use a <a href="http://hl7.org/fhir/r4/graphdefinition.html" class="external-link" rel="nofollow">GraphDefinition</a> resource.</p>

<p>This functionality should be the subject of a connectathon to determine practical solutions.</p>

<p>One possibility could be to leverage the List functionality described above to maintain a state of what <em>was</em> included in a previous content, however this obviously incurs additional overhead on the part of the server, and for many systems - especially those at scale like a national system - this is likely not practical.</p>

<h3 id="format-of-the-bulk-data-extract">Format of the bulk data extract</h3>

<p>The bulk extract format is always an nd-json file (new-line delimited json), and each file can only contain 1 resource type in it, but can be spread across multiple files, with either a size limit or count limit imposed by the extracting system, not the requestor.</p>

<p>The list of these files will be returned in the Complete status output, as described in the standard Bulk Data documentation.</p>

<h3 id="starting-the-extract">Starting the extract</h3>

<p>There are 2 options for starting the extract, one that is a single operation specifying all the content, and the other to be for a specific type only. These were both covered in the selecting the scope section above.</p>

<p>Here I will only document the use of the global export, as an initial request.</p>

<p>The initial request:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET [base]/$export?_type=Organization,Location,Practitioner,PractitionerRole,HealthcareService
</code></pre></div></div>
<p>with headers:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Accept: application/fhir+json&lt;/code&gt;
Authentication: Bearer [bearer token]&lt;/code&gt;
Prefer: respond-async&lt;/code&gt;
</code></pre></div></div>

<p>This will return either:</p>
<ul>
  <li>HTTP status code of <code>4XX</code> or <code>5XX</code> with an <code>OperationOutcome</code> resource body if the request fails,</li>
  <li>HTTP status code of <code>202 Accepted</code> when successful, with a <code>Content-Location</code> header with an absolute URI for subsequent status requests, and optionally an <code>OperationOutcome</code> in the resource body if desired</li>
</ul>

<p>Example Content-Location: <a class="external-link" style="text-decoration: underline;text-align: left;" rel="nofollow" href="http://example.org/status-tracking/request-123">http://example.org/status-tracking/request-123</a> (note that this is not necessarily a FHIR endpoint, and isn’t a true FHIR resource)</p>

<h3 id="tracking-the-status-of-the-extract">Tracking the status of the extract</h3>

<p>After a bulk data request has been started, the client MAY poll the URI provided in the <code>Content-Location</code> header.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET http://example.org/status-tracking/request-123
</code></pre></div></div>

<p>This will return:</p>

<ul>
  <li>
    <p>HTTP status code of <code>202 Accepted</code> when still in progress (and no body returned)</p>
  </li>
  <li>HTTP status code of <code>5XX</code> when a fatal error occurs, and an <code>OperationOutcome</code> in json format for the body with the detail of the error
<em>(Note this is a fatal error in processing, not some error encountered while processing files - a complete extract can contain errors)</em></li>
  <li>HTTP status code of <code>200 OK</code> when the processing is complete, and the result is a json object as noted in the specification (and an example included below)</li>
</ul>

<p>Refer to the build data specification for details of the completion event:</p>

<p>        <a href="https://github.com/smart-on-fhir/fhir-bulk-data-docs/blob/master/export.md#response---complete-status">https://github.com/smart-on-fhir/fhir-bulk-data-docs/blob/master/export.md#response—complete-status</a></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="dl">"</span><span class="s2">transactionTime</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">[instant]</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">[base]/$export?_type=Organization,Location,Practitioner,PractitionerRole,HealthcareService</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">requiresAccessToken</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">output</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Practitioner</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://serverpath2/practitioner_file_1.ndjson</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">count</span><span class="dl">"</span><span class="p">:</span> <span class="mi">10000</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Practitioner</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://serverpath2/practitioner_file_2.ndjson</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">count</span><span class="dl">"</span><span class="p">:</span> <span class="mi">3017</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Location</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://serverpath2/location_file_1.ndjson</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">count</span><span class="dl">"</span><span class="p">:</span> <span class="mi">4182</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="c1">// Note that this deletions property is a proposal, not part of the bulk data spec.</span>
    <span class="dl">"</span><span class="s2">deletions</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PractitionerRole</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://serverpath2/practitionerrole_deletions_1.ndjson</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// the bundle will include the total number of deletions in the file</span>
            <span class="dl">"</span><span class="s2">count</span><span class="dl">"</span><span class="p">:</span> <span class="mi">23</span> <span class="c1">// this is the number of bundles in the file, not the number of resources deleted</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">OperationOutcome</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://serverpath2/err_file_1.ndjson</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">count</span><span class="dl">"</span><span class="p">:</span> <span class="mi">439</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="retrieving-the-complete-extract">Retrieving the complete extract</h3>

<p>Once the tracking of the extract returns a <code>200 OK</code> completed status, the body of the result will include the list of prepared files that you can download.</p>

<p>Then each of these URLs can be downloaded by a simple get, ensuring to pass the Bearer token if the result indicates <code>requiresAccessToken = true</code></p>

<p>While downloading, also recommend including the header <code>Accept-Encoding: gzip</code> to compress the content as it comes down.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET http://serverpath2/location_file_1.ndjson
</code></pre></div></div>

<p>(Note: our implementation will probably always gzip encode the content - as we are likely to store the processing files gzip encoded to save space in the storage system)</p>

<p>Once you have downloaded all the files you need, you should tell the server to cleanup, which is detailed next.</p>

<h3 id="finishing-the-extract">Finishing the extract</h3>

<p>This is the simplest part of the process, and that is just calling <code>DELETE</code> on the status tracking URL.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DELETE http://example.org/status-tracking/request-123
</code></pre></div></div>

<p>This then tells the server that we are all finished with the data, and it can be deleted/cleaned up. The server may also include some time based limits where it may only keep it for a set period of time before it automatically cleans it up.</p>

<h2 id="subscriptions">Subscriptions</h2>
<p>A close relative to the bulk data extract is the subscriptions content - and how these will work in the context of Bulk Directory exchanges needs further experimentation and connectathon experiences.</p>

<p>These could be setup to monitor the directory for realtime changes to resources of interest, and are defined through the use of search parameters.</p>

<p>The “urgent notifications” channel is yet to be defined, but should enable specific actions such as license suspensions/revocations.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">   </span><span class="err">...TODO</span><span class="w"> </span><span class="err">edit</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>The FHIR Subscription API allows directories to (push) data to multiple local directories based on a set of criteria in the form of a FHIR query which defined by the subscriber.  For example:</p>

<ul>
  <li>All the updated data for a particular jurisdiction or region</li>
  <li>All the providers whose certification has been revoked or is expired or about to expire.</li>
</ul>

<p>Any newly created or updated resources that meet the criteria triggers the  Server to notify the subscriber and “forward” the results of the search criteria (e.g., the updated Practitioner, PractitionerRole and Endpoint resource - to a specified target endpoint).  Note that an alternate workflow is a Server notification without a payload and then the subscriber would fetch the data through the REST API from a predetermined endpoint - typically a “middleman” server.</p>

<p>Below is an example subscription to push all new and updated Practitioners, PractiyionerRoles, and  Endpoints from the ‘vhdir-demo’ server to the ‘local-dir’:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"resourceType"</span><span class="p">:</span><span class="s2">"Bundle"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"VhDir-subscription-bundle"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"meta"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"lastUpdated"</span><span class="p">:</span><span class="s2">"2017-01-24T01:43:30Z"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"transaction"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"entry"</span><span class="p">:[</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nl">"fullUrl"</span><span class="p">:</span><span class="s2">"urn:uuid:61ebe359-bfdc-4613-8bf2-c5e300945f0a"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"resource"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"resourceType"</span><span class="p">:</span><span class="s2">"Subscription"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"vhdir-connectathon-scenario-12p"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"requested"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"contact"</span><span class="p">:[</span><span class="w">
               </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"system"</span><span class="p">:</span><span class="s2">"phone"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"value"</span><span class="p">:</span><span class="s2">"ext 4123"</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"end"</span><span class="p">:</span><span class="s2">"2020-01-01T00:00:00Z"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"reason"</span><span class="p">:</span><span class="s2">"(push) healthcare directory data to multiple local directories"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"criteria"</span><span class="p">:</span><span class="s2">"Practitioner?address-postalcode:contains=02108, 02109, 02110, 02111, 02113, 02114, 02115, 02116, 02118, 02119, 02120, 02121, 02122, 02124, 02125, 02126, 02127, 02128, 02129, 02130, 02131, 02132, 02134, 02135, 02136, 02151, 02152, 02163, 02199, 02203, 02210, 02215, 02467"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"channel"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"rest-hook"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"endpoint"</span><span class="p">:</span><span class="s2">"https://local-dir/fhir"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"payload"</span><span class="p">:</span><span class="s2">"application/fhir+json"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"header"</span><span class="p">:[</span><span class="w">
                  </span><span class="s2">"Authorization: Bearer secret-token-abc-123"</span><span class="w">
               </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"request"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"method"</span><span class="p">:</span><span class="s2">"POST"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"Subscription"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nl">"fullUrl"</span><span class="p">:</span><span class="s2">"urn:uuid:61ebe359-bfdc-4613-8bf2-c5e300945f0a"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"resource"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"resourceType"</span><span class="p">:</span><span class="s2">"Subscription"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"vhdir-connectathon-scenario-12pr"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"requested"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"contact"</span><span class="p">:[</span><span class="w">
               </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"system"</span><span class="p">:</span><span class="s2">"phone"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"value"</span><span class="p">:</span><span class="s2">"ext 4123"</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"end"</span><span class="p">:</span><span class="s2">"2020-01-01T00:00:00Z"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"reason"</span><span class="p">:</span><span class="s2">"(push) healthcare directory data to multiple local directories"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"criteria"</span><span class="p">:</span><span class="s2">"PractitionerRole?practitioner.address-postalcode:contains=02108, 02109, 02110, 02111, 02113, 02114, 02115, 02116, 02118, 02119, 02120, 02121, 02122, 02124, 02125, 02126, 02127, 02128, 02129, 02130, 02131, 02132, 02134, 02135, 02136, 02151, 02152, 02163, 02199, 02203, 02210, 02215, 02467"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"channel"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"rest-hook"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"endpoint"</span><span class="p">:</span><span class="s2">"https://local-dir/fhir"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"payload"</span><span class="p">:</span><span class="s2">"application/fhir+json"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"header"</span><span class="p">:[</span><span class="w">
                  </span><span class="s2">"Authorization: Bearer secret-token-abc-123"</span><span class="w">
               </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"request"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"method"</span><span class="p">:</span><span class="s2">"POST"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"Subscription"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nl">"fullUrl"</span><span class="p">:</span><span class="s2">"urn:uuid:61ebe359-bfdc-4613-8bf2-c5e300945f0a"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"resource"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"resourceType"</span><span class="p">:</span><span class="s2">"Subscription"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"vhdir-connectathon-scenario-12pe"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"requested"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"contact"</span><span class="p">:[</span><span class="w">
               </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"system"</span><span class="p">:</span><span class="s2">"phone"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"value"</span><span class="p">:</span><span class="s2">"ext 4123"</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"end"</span><span class="p">:</span><span class="s2">"2020-01-01T00:00:00Z"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"reason"</span><span class="p">:</span><span class="s2">"(push) healthcare directory data to multiple local directories"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"criteria"</span><span class="p">:</span><span class="s2">"Endpoint?_has:PractitionerRole:endpoint:practitioner.address-postalcode:contains=02108, 02109, 02110, 02111, 02113, 02114, 02115, 02116, 02118, 02119, 02120, 02121, 02122, 02124, 02125, 02126, 02127, 02128, 02129, 02130, 02131, 02132, 02134, 02135, 02136, 02151, 02152, 02163, 02199, 02203, 02210, 02215, 02467"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"channel"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"rest-hook"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"endpoint"</span><span class="p">:</span><span class="s2">"https://local-dir/fhir"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"payload"</span><span class="p">:</span><span class="s2">"application/fhir+json"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"header"</span><span class="p">:[</span><span class="w">
                  </span><span class="s2">"Authorization: Bearer secret-token-abc-123"</span><span class="w">
               </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"request"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"method"</span><span class="p">:</span><span class="s2">"POST"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"Subscription"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>




</div>
        </div>  <!-- /inner-wrapper -->
      </div>  <!-- /row -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-content -->

  <script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

  <script type="text/javascript">
    $(document).ready(function(){
      if(window.location.hash != "") {
          $('a[href="' + window.location.hash + '"]').click()
      }
    });
  </script>
  <a name="bottom"> </a>
  <div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
    <div class="container">  <!-- container -->

      <div class="inner-wrapper">
        <p>
          IG &#169; 2022+ <a style="color:var(--footer-hyperlink-text-color)" href="http://www.hl7.org/Special/committees/pafm">HL7 International - Patient Administration Work Group</a>.  Package hl7-fhir-uv-vhdir#0.2.0 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Tue, Feb 15, 2022 20:43-0800">2022-02-15</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)"></span>
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                 
                
          </span>
        </p>
      </div>  <!-- /inner-wrapper -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
    <div class="container">  <!-- container -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-post-footer -->
  
  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
  <script type="text/javascript" src="assets/js/respond.min.js"> </script>
  <script type="text/javascript" src="assets/js/anchor.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard-btn.js"> </script>
  <script>anchors.options.visible = 'hover'
anchors.add()</script>
  
<!-- feedback form - Google forms -->
<!-- v0.1, 2021-01-09 -->



<!-- / feedback form  -->

  <!-- Analytics Below
  ================================================== -->
  </body>
</html>

